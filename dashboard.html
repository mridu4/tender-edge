<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TenderEdge â€” Live Intelligence Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050c0f;
    --bg2: #080f14;
    --bg3: #0c1a20;
    --surface: #0f2028;
    --surface2: #132530;
    --green: #00e5b0;
    --green2: #00c49a;
    --teal: #00b8d9;
    --red: #ff4d6d;
    --orange: #ff9a3c;
    --yellow: #ffd166;
    --purple: #9b5de5;
    --glow: rgba(0,229,176,0.12);
    --text: #e8f4f0;
    --text2: #8ab8aa;
    --text3: #4d7a6e;
    --border: rgba(0,229,176,0.12);
    --border2: rgba(0,229,176,0.06);
    --font-display: 'Syne', sans-serif;
    --font-mono: 'DM Mono', monospace;
    --font-body: 'Manrope', sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-body);
    font-size: 14px;
    min-height: 100vh;
    display: flex;
  }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    width: 240px;
    min-height: 100vh;
    background: var(--bg2);
    border-right: 1px solid var(--border2);
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    z-index: 50;
  }

  .sidebar-logo {
    padding: 28px 24px 20px;
    border-bottom: 1px solid var(--border2);
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 800;
    text-decoration: none;
    color: var(--text);
  }

  .sidebar-logo .logo-box {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, var(--green), var(--teal));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
  }

  .sidebar-logo span { color: var(--green); }

  .sidebar-section {
    padding: 20px 16px 8px;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text3);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .sidebar-nav { padding: 0 12px; flex: 1; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 10px;
    color: var(--text3);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 2px;
    text-decoration: none;
  }

  .nav-item:hover, .nav-item.active {
    background: rgba(0,229,176,0.08);
    color: var(--green);
  }

  .nav-item .ni-icon { font-size: 16px; width: 20px; text-align: center; }

  .nav-item .ni-badge {
    margin-left: auto;
    font-family: var(--font-mono);
    font-size: 10px;
    background: rgba(0,229,176,0.15);
    color: var(--green);
    padding: 2px 7px;
    border-radius: 100px;
  }

  .sidebar-footer {
    padding: 20px 16px;
    border-top: 1px solid var(--border2);
  }

  .poll-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--green), var(--teal));
    color: var(--bg);
    border: none;
    padding: 10px;
    border-radius: 10px;
    font-family: var(--font-display);
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: opacity 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }

  .poll-btn:hover { opacity: 0.85; }
  .poll-btn:disabled { opacity: 0.5; cursor: not-allowed; }

  .last-sync {
    text-align: center;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text3);
    margin-top: 8px;
  }

  /* â”€â”€ MAIN â”€â”€ */
  .main {
    margin-left: 240px;
    flex: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* â”€â”€ TOPBAR â”€â”€ */
  .topbar {
    background: rgba(5,12,15,0.9);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border2);
    padding: 0 32px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 40;
  }

  .topbar-title {
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 700;
  }

  .topbar-right {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .search-bar {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 8px;
    padding: 8px 16px;
    font-family: var(--font-body);
    font-size: 13px;
    color: var(--text);
    outline: none;
    width: 260px;
    transition: border-color 0.2s;
  }

  .search-bar::placeholder { color: var(--text3); }
  .search-bar:focus { border-color: rgba(0,229,176,0.3); }

  .filter-pill {
    padding: 6px 14px;
    border-radius: 8px;
    border: 1px solid var(--border2);
    background: var(--surface);
    color: var(--text2);
    font-size: 12px;
    font-family: var(--font-body);
    cursor: pointer;
    transition: all 0.2s;
    outline: none;
  }

  .filter-pill:hover, .filter-pill.active {
    border-color: rgba(0,229,176,0.3);
    color: var(--green);
    background: rgba(0,229,176,0.06);
  }

  .live-dot {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--green);
  }

  .live-dot::before {
    content: '';
    width: 7px; height: 7px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(0,229,176,0.4); }
    50% { opacity: 0.7; box-shadow: 0 0 0 6px rgba(0,229,176,0); }
  }

  /* â”€â”€ CONTENT â”€â”€ */
  .content { padding: 28px 32px; flex: 1; }

  /* â”€â”€ STAT CARDS â”€â”€ */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 14px;
    padding: 20px 24px;
    position: relative;
    overflow: hidden;
    transition: all 0.3s;
  }

  .stat-card:hover {
    border-color: var(--border);
    transform: translateY(-2px);
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--green), var(--teal));
    opacity: 0;
    transition: opacity 0.3s;
  }

  .stat-card:hover::before { opacity: 1; }

  .stat-label {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 10px;
  }

  .stat-value {
    font-family: var(--font-display);
    font-size: 36px;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 6px;
  }

  .stat-sub {
    font-size: 12px;
    color: var(--text3);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .stat-up { color: var(--green); }
  .stat-icon {
    position: absolute;
    top: 20px; right: 20px;
    font-size: 28px;
    opacity: 0.2;
  }

  /* â”€â”€ MAIN GRID â”€â”€ */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 20px;
  }

  /* â”€â”€ TENDER TABLE â”€â”€ */
  .panel {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 16px;
    overflow: hidden;
  }

  .panel-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .panel-title {
    font-family: var(--font-display);
    font-size: 15px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .panel-action {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--green);
    cursor: pointer;
    border: 1px solid rgba(0,229,176,0.2);
    padding: 4px 12px;
    border-radius: 6px;
    background: rgba(0,229,176,0.05);
    transition: all 0.2s;
  }

  .panel-action:hover { background: rgba(0,229,176,0.12); }

  .tender-table { width: 100%; border-collapse: collapse; }

  .tender-table th {
    padding: 10px 16px;
    text-align: left;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-bottom: 1px solid var(--border2);
    background: var(--bg3);
    white-space: nowrap;
  }

  .tender-table td {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(0,229,176,0.04);
    vertical-align: middle;
  }

  .tender-table tr:last-child td { border-bottom: none; }

  .tender-table tr {
    transition: background 0.15s;
    cursor: pointer;
  }

  .tender-table tr:hover td { background: rgba(0,229,176,0.03); }

  .tender-title-cell {
    font-weight: 600;
    font-size: 13px;
    color: var(--text);
    max-width: 280px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .tender-pe {
    font-size: 11px;
    color: var(--text3);
    margin-top: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 280px;
  }

  .sector-badge {
    display: inline-flex;
    align-items: center;
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 3px 10px;
    border-radius: 100px;
    white-space: nowrap;
    font-weight: 500;
  }

  .sector-ICT         { background: rgba(0,184,217,0.12); color: var(--teal); }
  .sector-Construction{ background: rgba(255,154,60,0.12); color: var(--orange); }
  .sector-Medical     { background: rgba(255,77,109,0.12); color: var(--red); }
  .sector-Consultancy { background: rgba(155,93,229,0.12); color: var(--purple); }
  .sector-Energy      { background: rgba(255,209,102,0.12); color: var(--yellow); }
  .sector-Supply      { background: rgba(0,229,176,0.12); color: var(--green); }
  .sector-Other       { background: rgba(100,120,120,0.12); color: var(--text3); }

  .relevance-badge {
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 3px 10px;
    border-radius: 100px;
    font-weight: 600;
  }

  .rel-HIGH   { background: rgba(0,229,176,0.15); color: var(--green); }
  .rel-MEDIUM { background: rgba(255,209,102,0.15); color: var(--yellow); }
  .rel-LOW    { background: rgba(100,120,120,0.1); color: var(--text3); }

  .value-cell {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text2);
    white-space: nowrap;
  }

  .deadline-cell {
    font-family: var(--font-mono);
    font-size: 11px;
    white-space: nowrap;
  }

  .deadline-urgent { color: var(--red); }
  .deadline-soon   { color: var(--yellow); }
  .deadline-ok     { color: var(--text3); }

  /* â”€â”€ RIGHT PANEL â”€â”€ */
  .right-col { display: flex; flex-direction: column; gap: 20px; }

  /* Sector Breakdown */
  .sector-list { padding: 16px 20px; }

  .sector-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }

  .sector-row:last-child { margin-bottom: 0; }

  .sector-row-label {
    font-size: 13px;
    color: var(--text2);
    width: 120px;
    flex-shrink: 0;
  }

  .sector-track {
    flex: 1;
    height: 6px;
    background: var(--bg3);
    border-radius: 3px;
    overflow: hidden;
  }

  .sector-fill {
    height: 100%;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--green), var(--teal));
    transition: width 1s ease;
  }

  .sector-count {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text3);
    width: 24px;
    text-align: right;
  }

  /* Pricing Benchmarks */
  .pricing-list { padding: 16px 20px; }

  .pricing-row {
    background: var(--bg3);
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 10px;
    border: 1px solid var(--border2);
  }

  .pricing-row:last-child { margin-bottom: 0; }

  .pricing-row-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }

  .pricing-row-sector {
    font-size: 13px;
    font-weight: 600;
  }

  .pricing-row-ratio {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--green);
  }

  .pricing-range-bar {
    height: 4px;
    background: var(--bg);
    border-radius: 2px;
    position: relative;
    overflow: visible;
  }

  .pricing-range-fill {
    position: absolute;
    height: 100%;
    background: linear-gradient(90deg, var(--green), var(--teal));
    border-radius: 2px;
  }

  .pricing-range-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 4px;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text3);
  }

  /* Awards Feed */
  .awards-list { padding: 16px 20px; }

  .award-item {
    display: flex;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border2);
    align-items: flex-start;
  }

  .award-item:last-child { border-bottom: none; }

  .award-icon {
    width: 32px; height: 32px;
    border-radius: 8px;
    background: rgba(0,229,176,0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .award-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--text);
    line-height: 1.4;
    margin-bottom: 3px;
  }

  .award-winner {
    font-size: 11px;
    color: var(--text3);
  }

  .award-ratio {
    margin-left: auto;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--teal);
    flex-shrink: 0;
  }

  /* â”€â”€ MODAL â”€â”€ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(4px);
    z-index: 200;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 40px;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 640px;
    max-height: 80vh;
    overflow-y: auto;
  }

  .modal-header {
    padding: 24px 28px;
    border-bottom: 1px solid var(--border2);
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 20px;
  }

  .modal-title {
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 700;
    line-height: 1.3;
  }

  .modal-close {
    background: none;
    border: none;
    color: var(--text3);
    font-size: 20px;
    cursor: pointer;
    padding: 4px;
    transition: color 0.2s;
    flex-shrink: 0;
  }

  .modal-close:hover { color: var(--text); }

  .modal-body { padding: 24px 28px; }

  .modal-field {
    margin-bottom: 20px;
  }

  .modal-field-label {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 6px;
  }

  .modal-field-value {
    font-size: 14px;
    color: var(--text2);
    line-height: 1.6;
  }

  .modal-highlight {
    font-family: var(--font-mono);
    font-size: 14px;
    color: var(--green);
  }

  .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

  .modal-actions {
    padding: 20px 28px;
    border-top: 1px solid var(--border2);
    display: flex;
    gap: 12px;
  }

  .modal-btn-primary {
    flex: 1;
    background: linear-gradient(135deg, var(--green), var(--teal));
    color: var(--bg);
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .modal-btn-primary:hover { opacity: 0.85; }

  .modal-btn-secondary {
    flex: 1;
    background: none;
    color: var(--text2);
    border: 1px solid var(--border);
    padding: 12px;
    border-radius: 10px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .modal-btn-secondary:hover { border-color: rgba(0,229,176,0.3); color: var(--green); }

  /* â”€â”€ LOADING SKELETON â”€â”€ */
  .skeleton {
    background: linear-gradient(90deg, var(--surface) 25%, var(--surface2) 50%, var(--surface) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 6px;
  }

  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* â”€â”€ EMPTY STATE â”€â”€ */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text3);
  }

  .empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }
  .empty-text { font-size: 14px; }

  /* â”€â”€ NOTIFICATION TOAST â”€â”€ */
  .toast {
    position: fixed;
    bottom: 32px;
    right: 32px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 20px;
    font-size: 13px;
    color: var(--text);
    z-index: 300;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    max-width: 320px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }

  .toast.show { transform: translateY(0); opacity: 1; }

  /* â”€â”€ PAGINATION â”€â”€ */
  .pagination {
    padding: 16px 24px;
    border-top: 1px solid var(--border2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .page-info {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text3);
  }

  .page-btns { display: flex; gap: 8px; }

  .page-btn {
    padding: 6px 14px;
    border-radius: 7px;
    border: 1px solid var(--border2);
    background: var(--bg3);
    color: var(--text2);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .page-btn:hover { border-color: rgba(0,229,176,0.3); color: var(--green); }
  .page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <a href="index.html" class="sidebar-logo">
    <div class="logo-box">âš¡</div>
    Tender<span>Edge</span>
  </a>

  <div class="sidebar-section">Intelligence</div>
  <nav class="sidebar-nav">
    <a class="nav-item active" onclick="showView('tenders')">
      <span class="ni-icon">ğŸ“‹</span> Live Tenders
      <span class="ni-badge" id="badge-total">â€”</span>
    </a>
    <a class="nav-item" onclick="showView('high')">
      <span class="ni-icon">ğŸ¯</span> High Priority
      <span class="ni-badge" id="badge-high">â€”</span>
    </a>
    <a class="nav-item" onclick="showView('awards')">
      <span class="ni-icon">ğŸ†</span> Award Records
    </a>
    <a class="nav-item" onclick="showView('pricing')">
      <span class="ni-icon">ğŸ’°</span> Pricing Benchmarks
    </a>

    <div class="sidebar-section" style="padding-left:0;margin-top:8px">Portals</div>
    <a class="nav-item" href="https://nest.go.tz" target="_blank">
      <span class="ni-icon">ğŸ‡¹ğŸ‡¿</span> NeST Tanzania
    </a>
    <a class="nav-item" href="https://tenders.go.ke/tenders" target="_blank">
      <span class="ni-icon">ğŸ‡°ğŸ‡ª</span> Kenya Tenders
    </a>
    <a class="nav-item" href="https://www.ppra.go.tz" target="_blank">
      <span class="ni-icon">ğŸ›ï¸</span> PPRA Tanzania
    </a>
  </nav>

  <div class="sidebar-footer">
    <button class="poll-btn" onclick="triggerPoll()" id="poll-btn">
      âŸ³ Sync Now
    </button>
    <div class="last-sync" id="last-sync">Last sync: Never</div>
  </div>
</aside>

<!-- MAIN -->
<div class="main">

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-title" id="view-title">Live Tender Intelligence</div>
    <div class="topbar-right">
      <input type="text" class="search-bar" placeholder="ğŸ”  Search tenders, PEs, sectors..." oninput="filterTenders(this.value)" />
      <select class="filter-pill" id="sector-filter" onchange="applySectorFilter(this.value)">
        <option value="">All Sectors</option>
        <option value="ICT">ICT</option>
        <option value="Construction">Construction</option>
        <option value="Medical">Medical</option>
        <option value="Consultancy">Consultancy</option>
        <option value="Energy">Energy</option>
        <option value="Supply/Goods">Supply/Goods</option>
      </select>
      <select class="filter-pill" id="relevance-filter" onchange="applyRelevanceFilter(this.value)">
        <option value="">All Relevance</option>
        <option value="HIGH">ğŸ”´ High</option>
        <option value="MEDIUM">ğŸŸ¡ Medium</option>
        <option value="LOW">âšª Low</option>
      </select>
      <div class="live-dot">LIVE</div>
    </div>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <!-- STAT CARDS -->
    <div class="stats-row" id="stats-row">
      <div class="stat-card">
        <div class="stat-label">Total Tenders</div>
        <div class="stat-value grad" id="stat-total" style="background:linear-gradient(135deg,var(--green),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">â€”</div>
        <div class="stat-sub"><span class="stat-up">â†‘</span> From NeST & Kenya portals</div>
        <div class="stat-icon">ğŸ“‹</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">High Relevance</div>
        <div class="stat-value" id="stat-high" style="color:var(--green)">â€”</div>
        <div class="stat-sub">Matching your profile</div>
        <div class="stat-icon">ğŸ¯</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Award Records</div>
        <div class="stat-value" id="stat-awards" style="color:var(--teal)">â€”</div>
        <div class="stat-sub">Pricing intelligence data</div>
        <div class="stat-icon">ğŸ†</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Avg Win Price Ratio</div>
        <div class="stat-value" id="stat-ratio" style="color:var(--yellow)">93%</div>
        <div class="stat-sub">Of tender estimate (TZ avg)</div>
        <div class="stat-icon">ğŸ’°</div>
      </div>
    </div>

    <!-- MAIN GRID -->
    <div class="main-grid">

      <!-- LEFT: TENDER TABLE -->
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">
            ğŸ“‹ Live Tenders
            <span style="font-family:var(--font-mono);font-size:11px;color:var(--text3);font-weight:400" id="table-count"></span>
          </div>
          <div style="display:flex;gap:8px">
            <div class="panel-action" onclick="exportCSV()">â¬‡ Export CSV</div>
          </div>
        </div>

        <table class="tender-table" id="tender-table">
          <thead>
            <tr>
              <th>Tender</th>
              <th>Sector</th>
              <th>Priority</th>
              <th>Value</th>
              <th>Deadline</th>
            </tr>
          </thead>
          <tbody id="tender-tbody">
            <tr>
              <td colspan="5">
                <div style="padding:40px;text-align:center;color:var(--text3)">
                  <div style="font-size:30px;margin-bottom:10px">âš¡</div>
                  Loading tenders...
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="pagination">
          <div class="page-info" id="page-info">Page 1</div>
          <div class="page-btns">
            <button class="page-btn" onclick="prevPage()" id="btn-prev" disabled>â† Prev</button>
            <button class="page-btn" onclick="nextPage()" id="btn-next">Next â†’</button>
          </div>
        </div>
      </div>

      <!-- RIGHT COL -->
      <div class="right-col">

        <!-- Sector Breakdown -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">ğŸ“Š By Sector</div>
          </div>
          <div class="sector-list" id="sector-list">
            <div class="skeleton" style="height:12px;margin-bottom:16px"></div>
            <div class="skeleton" style="height:12px;margin-bottom:16px;width:80%"></div>
            <div class="skeleton" style="height:12px;margin-bottom:16px;width:60%"></div>
          </div>
        </div>

        <!-- Pricing Benchmarks -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">ğŸ’° Pricing Benchmarks</div>
            <div class="panel-action" onclick="showView('pricing')">View All</div>
          </div>
          <div class="pricing-list" id="pricing-list">
            <div class="pricing-row">
              <div class="pricing-row-header">
                <div class="pricing-row-sector">ICT</div>
                <div class="pricing-row-ratio">~92% of estimate</div>
              </div>
              <div class="pricing-range-bar">
                <div class="pricing-range-fill" style="left:75%;width:20%"></div>
              </div>
              <div class="pricing-range-labels"><span>85%</span><span>95%</span></div>
            </div>
            <div class="pricing-row">
              <div class="pricing-row-header">
                <div class="pricing-row-sector">Construction</div>
                <div class="pricing-row-ratio">~93% of estimate</div>
              </div>
              <div class="pricing-range-bar">
                <div class="pricing-range-fill" style="left:72%;width:22%"></div>
              </div>
              <div class="pricing-range-labels"><span>86%</span><span>97%</span></div>
            </div>
            <div class="pricing-row">
              <div class="pricing-row-header">
                <div class="pricing-row-sector">Medical</div>
                <div class="pricing-row-ratio">~90% of estimate</div>
              </div>
              <div class="pricing-range-bar">
                <div class="pricing-range-fill" style="left:70%;width:20%"></div>
              </div>
              <div class="pricing-range-labels"><span>83%</span><span>94%</span></div>
            </div>
          </div>
        </div>

        <!-- Recent Awards -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">ğŸ† Recent Awards</div>
            <div class="panel-action" onclick="showView('awards')">View All</div>
          </div>
          <div class="awards-list" id="awards-list">
            <div class="skeleton" style="height:48px;margin-bottom:12px;border-radius:10px"></div>
            <div class="skeleton" style="height:48px;margin-bottom:12px;border-radius:10px"></div>
            <div class="skeleton" style="height:48px;border-radius:10px"></div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- TENDER DETAIL MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="modal-title" id="modal-title">Tender Details</div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-actions">
      <button class="modal-btn-primary">ğŸ“ Draft Proposal with AI</button>
      <button class="modal-btn-secondary">ğŸ“‹ Add to Watchlist</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API = 'http://localhost:5000/api';
let allTenders = [];
let filteredTenders = [];
let currentPage = 1;
const PER_PAGE = 15;
let searchQuery = '';
let sectorFilter = '';
let relevanceFilter = '';

// â”€â”€ DEMO DATA (used when API offline) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEMO = {
  stats: {
    total_tenders: 847,
    high_relevance: 124,
    total_awards: 312,
  },
  tenders: [
    { ocid:'ocds-TZ-2025-001', title:'Supply of ICT Equipment to Ministry of Finance', procuring_entity:'Ministry of Finance Tanzania', sector:'ICT', relevance_score:'HIGH', value_amount:285000000, value_currency:'TZS', deadline:'2025-04-15T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-002', title:'Construction of District Hospital â€” Dodoma Region', procuring_entity:'Ministry of Health', sector:'Construction', relevance_score:'HIGH', value_amount:4500000000, value_currency:'TZS', deadline:'2025-05-01T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-003', title:'Consultancy for Road Feasibility Study â€” Mwanza', procuring_entity:'Tanzania Roads Authority (TANROADS)', sector:'Consultancy', relevance_score:'HIGH', value_amount:180000000, value_currency:'TZS', deadline:'2025-04-20T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-004', title:'Annual Supply of Essential Medicines and Medical Consumables', procuring_entity:'Medical Stores Department (MSD)', sector:'Medical', relevance_score:'HIGH', value_amount:920000000, value_currency:'TZS', deadline:'2025-04-30T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-005', title:'Solar Power Installation â€” Rural Electrification Zanzibar', procuring_entity:'ZECO Zanzibar', sector:'Energy', relevance_score:'HIGH', value_amount:3200000000, value_currency:'TZS', deadline:'2025-05-15T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-006', title:'Supply of Office Furniture â€” PPRA New Headquarters', procuring_entity:'PPRA Tanzania', sector:'Supply/Goods', relevance_score:'MEDIUM', value_amount:45000000, value_currency:'TZS', deadline:'2025-04-10T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-007', title:'Rehabilitation of Dar es Salaam Port Access Roads', procuring_entity:'Tanzania Ports Authority (TPA)', sector:'Construction', relevance_score:'HIGH', value_amount:6800000000, value_currency:'TZS', deadline:'2025-05-20T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-008', title:'Enterprise Resource Planning (ERP) System Implementation', procuring_entity:'Ministry of Finance Tanzania', sector:'ICT', relevance_score:'HIGH', value_amount:1200000000, value_currency:'TZS', deadline:'2025-06-01T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-KE-2025-001', title:'Supply of Laptops and Network Infrastructure â€” Kenya Revenue Authority', procuring_entity:'Kenya Revenue Authority (KRA)', sector:'ICT', relevance_score:'HIGH', value_amount:45000000, value_currency:'KES', deadline:'2025-04-25T23:59:00Z', status:'active', source:'Kenya Tenders Portal' },
    { ocid:'ocds-TZ-2025-009', title:'Water Supply and Sanitation Project â€” Tabora Region', procuring_entity:'RUWASA Tanzania', sector:'Construction', relevance_score:'MEDIUM', value_amount:2100000000, value_currency:'TZS', deadline:'2025-05-10T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-010', title:'Pharmaceutical Cold Chain Equipment Supply', procuring_entity:'Medical Stores Department (MSD)', sector:'Medical', relevance_score:'MEDIUM', value_amount:340000000, value_currency:'TZS', deadline:'2025-04-28T23:59:00Z', status:'active', source:'NeST Tanzania' },
    { ocid:'ocds-TZ-2025-011', title:'Environmental Impact Assessment Study â€” SGR Phase II', procuring_entity:'Tanzania Railways Corporation', sector:'Consultancy', relevance_score:'MEDIUM', value_amount:95000000, value_currency:'TZS', deadline:'2025-05-05T23:59:00Z', status:'active', source:'NeST Tanzania' },
  ],
  awards: [
    { ocid:'A01', tender_title:'Supply of 200 Computers to TRA', winner_name:'ABC Tech Solutions Ltd', award_value:185000000, award_currency:'TZS', award_date:'2024-11-15', price_ratio:0.925 },
    { ocid:'A02', tender_title:'Road Rehabilitation Moshi-Arusha', winner_name:'Strabag East Africa', award_value:4200000000, award_currency:'TZS', award_date:'2024-10-20', price_ratio:0.933 },
    { ocid:'A03', tender_title:'Medical Supplies MSD Q3', winner_name:'Pharmaceutical Distributors TZ', award_value:850000000, award_currency:'TZS', award_date:'2024-09-30', price_ratio:0.924 },
  ],
  sectors: { 'Construction':312, 'ICT':198, 'Medical':124, 'Consultancy':98, 'Energy':67, 'Supply/Goods':48 }
};

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  loadData();
  // Auto-refresh every 5 min
  setInterval(loadData, 300000);
});

async function loadData() {
  try {
    const [statsRes, tendersRes, awardsRes] = await Promise.all([
      fetch(`${API}/stats`),
      fetch(`${API}/tenders?per_page=100`),
      fetch(`${API}/awards`)
    ]);

    if (!statsRes.ok) throw new Error('API offline');

    const stats = await statsRes.json();
    const tendersData = await tendersRes.json();
    const awards = await awardsRes.json();

    renderStats(stats);
    allTenders = tendersData.tenders || [];
    filteredTenders = [...allTenders];
    renderTenderTable();
    renderSectors(stats.by_sector || {});
    renderAwards(awards.slice(0, 4));

  } catch (e) {
    // API offline â€” use demo data
    console.log('API offline, using demo data');
    renderStats(DEMO.stats);
    allTenders = DEMO.tenders;
    filteredTenders = [...allTenders];
    renderTenderTable();
    renderSectors(DEMO.sectors);
    renderAwards(DEMO.awards);
    updateLastSync('Demo mode (API offline)');
  }
}

// â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStats(stats) {
  animateNum('stat-total', stats.total_tenders);
  animateNum('stat-high', stats.high_relevance);
  animateNum('stat-awards', stats.total_awards);
  document.getElementById('badge-total').textContent = stats.total_tenders;
  document.getElementById('badge-high').textContent = stats.high_relevance;
}

function animateNum(id, target) {
  const el = document.getElementById(id);
  if (!el) return;
  let start = 0;
  const step = Math.ceil(target / 40);
  const timer = setInterval(() => {
    start = Math.min(start + step, target);
    el.textContent = start.toLocaleString();
    if (start >= target) clearInterval(timer);
  }, 30);
}

// â”€â”€ SECTOR BREAKDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSectors(sectors) {
  const max = Math.max(...Object.values(sectors), 1);
  const html = Object.entries(sectors)
    .sort((a,b) => b[1] - a[1])
    .map(([name, count]) => `
      <div class="sector-row">
        <div class="sector-row-label">${name}</div>
        <div class="sector-track">
          <div class="sector-fill" style="width:${Math.round(count/max*100)}%"></div>
        </div>
        <div class="sector-count">${count}</div>
      </div>
    `).join('');
  document.getElementById('sector-list').innerHTML = html;
}

// â”€â”€ AWARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAwards(awards) {
  if (!awards.length) {
    document.getElementById('awards-list').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ†</div><div class="empty-text">No award records yet</div></div>';
    return;
  }
  document.getElementById('awards-list').innerHTML = awards.map(a => `
    <div class="award-item">
      <div class="award-icon">ğŸ†</div>
      <div style="flex:1;min-width:0">
        <div class="award-title">${(a.tender_title||'').substring(0,55)}${(a.tender_title||'').length>55?'...':''}</div>
        <div class="award-winner">${a.winner_name||'Unknown'}</div>
      </div>
      <div class="award-ratio">${a.price_ratio ? Math.round(a.price_ratio*100)+'%' : 'â€”'}</div>
    </div>
  `).join('');
}

// â”€â”€ TENDER TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTenderTable() {
  const start = (currentPage - 1) * PER_PAGE;
  const page = filteredTenders.slice(start, start + PER_PAGE);

  document.getElementById('table-count').textContent = `(${filteredTenders.length} tenders)`;
  document.getElementById('page-info').textContent = `Page ${currentPage} of ${Math.ceil(filteredTenders.length / PER_PAGE) || 1}`;
  document.getElementById('btn-prev').disabled = currentPage <= 1;
  document.getElementById('btn-next').disabled = currentPage >= Math.ceil(filteredTenders.length / PER_PAGE);

  if (!page.length) {
    document.getElementById('tender-tbody').innerHTML = `
      <tr><td colspan="5">
        <div class="empty-state">
          <div class="empty-icon">ğŸ”</div>
          <div class="empty-text">No tenders match your filters</div>
        </div>
      </td></tr>`;
    return;
  }

  document.getElementById('tender-tbody').innerHTML = page.map(t => `
    <tr onclick="openModal('${t.ocid}')">
      <td>
        <div class="tender-title-cell">${t.title || 'Untitled'}</div>
        <div class="tender-pe">${t.procuring_entity || 'â€”'} Â· ${t.source || 'NeST'}</div>
      </td>
      <td><span class="sector-badge sector-${(t.sector||'Other').replace('/','')}">${t.sector || 'Other'}</span></td>
      <td><span class="relevance-badge rel-${t.relevance_score || 'LOW'}">${t.relevance_score || 'LOW'}</span></td>
      <td class="value-cell">${formatValue(t.value_amount, t.value_currency)}</td>
      <td class="deadline-cell ${deadlineClass(t.deadline)}">${formatDeadline(t.deadline)}</td>
    </tr>
  `).join('');
}

function formatValue(amount, currency) {
  if (!amount) return 'â€”';
  const c = currency || 'TZS';
  if (amount >= 1e9) return `${c} ${(amount/1e9).toFixed(1)}B`;
  if (amount >= 1e6) return `${c} ${(amount/1e6).toFixed(1)}M`;
  if (amount >= 1e3) return `${c} ${(amount/1e3).toFixed(0)}K`;
  return `${c} ${amount}`;
}

function formatDeadline(dl) {
  if (!dl) return 'â€”';
  const d = new Date(dl);
  const now = new Date();
  const diff = Math.ceil((d - now) / 86400000);
  if (diff < 0) return 'Expired';
  if (diff === 0) return 'Today!';
  if (diff <= 7) return `${diff}d left`;
  return d.toLocaleDateString('en-GB', { day:'numeric', month:'short' });
}

function deadlineClass(dl) {
  if (!dl) return '';
  const diff = Math.ceil((new Date(dl) - new Date()) / 86400000);
  if (diff < 0) return 'deadline-urgent';
  if (diff <= 7) return 'deadline-urgent';
  if (diff <= 21) return 'deadline-soon';
  return 'deadline-ok';
}

// â”€â”€ FILTERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterTenders(q) {
  searchQuery = q.toLowerCase();
  applyFilters();
}

function applySectorFilter(v) {
  sectorFilter = v;
  applyFilters();
}

function applyRelevanceFilter(v) {
  relevanceFilter = v;
  applyFilters();
}

function applyFilters() {
  currentPage = 1;
  filteredTenders = allTenders.filter(t => {
    const matchSearch = !searchQuery ||
      (t.title||'').toLowerCase().includes(searchQuery) ||
      (t.procuring_entity||'').toLowerCase().includes(searchQuery) ||
      (t.sector||'').toLowerCase().includes(searchQuery);
    const matchSector = !sectorFilter || t.sector === sectorFilter;
    const matchRel = !relevanceFilter || t.relevance_score === relevanceFilter;
    return matchSearch && matchSector && matchRel;
  });
  renderTenderTable();
}

// â”€â”€ PAGINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nextPage() { currentPage++; renderTenderTable(); window.scrollTo(0,200); }
function prevPage() { currentPage--; renderTenderTable(); window.scrollTo(0,200); }

// â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(ocid) {
  const t = allTenders.find(x => x.ocid === ocid);
  if (!t) return;

  document.getElementById('modal-title').textContent = t.title || 'Tender Details';

  const diffDays = t.deadline ?
    Math.ceil((new Date(t.deadline) - new Date()) / 86400000) : null;

  document.getElementById('modal-body').innerHTML = `
    <div class="modal-grid" style="margin-bottom:20px">
      <div class="modal-field">
        <div class="modal-field-label">OCID</div>
        <div class="modal-highlight">${t.ocid}</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Source Portal</div>
        <div class="modal-field-value">${t.source || 'NeST Tanzania'}</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Priority Score</div>
        <div><span class="relevance-badge rel-${t.relevance_score}">${t.relevance_score}</span></div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Sector</div>
        <div><span class="sector-badge sector-${(t.sector||'Other').replace('/','')}">${t.sector}</span></div>
      </div>
    </div>
    <div class="modal-field">
      <div class="modal-field-label">Procuring Entity</div>
      <div class="modal-field-value" style="font-weight:600;color:var(--text)">${t.procuring_entity || 'â€”'}</div>
    </div>
    <div class="modal-field">
      <div class="modal-field-label">Description</div>
      <div class="modal-field-value">${t.description || 'No description available.'}</div>
    </div>
    <div class="modal-grid">
      <div class="modal-field">
        <div class="modal-field-label">Contract Value</div>
        <div class="modal-highlight">${formatValue(t.value_amount, t.value_currency)}</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Submission Deadline</div>
        <div class="modal-highlight ${deadlineClass(t.deadline)}">
          ${t.deadline ? new Date(t.deadline).toLocaleDateString('en-GB', {day:'numeric',month:'long',year:'numeric'}) : 'â€”'}
          ${diffDays !== null ? `<span style="font-size:12px;color:var(--text3)"> (${diffDays > 0 ? diffDays + ' days' : 'Expired'})</span>` : ''}
        </div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Status</div>
        <div class="modal-field-value" style="text-transform:capitalize">${t.status || 'active'}</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Published</div>
        <div class="modal-field-value">${t.published_date ? new Date(t.published_date).toLocaleDateString('en-GB') : 'â€”'}</div>
      </div>
    </div>
  `;

  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(e) {
  if (!e || e.target === document.getElementById('modal-overlay')) {
    document.getElementById('modal-overlay').classList.remove('open');
  }
}

// â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showView(view) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  event?.currentTarget?.classList?.add('active');

  const titles = {
    tenders: 'Live Tender Intelligence',
    high: 'High Priority Tenders',
    awards: 'Award Records',
    pricing: 'Pricing Benchmarks'
  };
  document.getElementById('view-title').textContent = titles[view] || 'Dashboard';

  if (view === 'high') {
    filteredTenders = allTenders.filter(t => t.relevance_score === 'HIGH');
    currentPage = 1;
    document.getElementById('relevance-filter').value = 'HIGH';
    renderTenderTable();
  } else if (view === 'tenders') {
    filteredTenders = [...allTenders];
    currentPage = 1;
    document.getElementById('relevance-filter').value = '';
    renderTenderTable();
  }
}

// â”€â”€ POLL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function triggerPoll() {
  const btn = document.getElementById('poll-btn');
  btn.disabled = true;
  btn.textContent = 'âŸ³ Syncing...';
  showToast('âŸ³ Syncing with NeST Tanzania API...');

  try {
    await fetch(`${API}/poll`, { method: 'POST' });
    setTimeout(() => {
      loadData();
      showToast('âœ… Sync complete! New tenders loaded.');
      updateLastSync(new Date().toLocaleTimeString());
      btn.disabled = false;
      btn.textContent = 'âŸ³ Sync Now';
    }, 3000);
  } catch {
    showToast('âš¡ Demo mode â€” connect API server to sync live data');
    btn.disabled = false;
    btn.textContent = 'âŸ³ Sync Now';
  }
}

function updateLastSync(text) {
  document.getElementById('last-sync').textContent = 'Last sync: ' + text;
}

// â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportCSV() {
  const headers = ['OCID','Title','Procuring Entity','Sector','Priority','Value','Currency','Deadline','Source'];
  const rows = filteredTenders.map(t => [
    t.ocid, `"${(t.title||'').replace(/"/g,'""')}"`,
    `"${(t.procuring_entity||'').replace(/"/g,'""')}"`,
    t.sector, t.relevance_score, t.value_amount||'', t.value_currency||'TZS',
    t.deadline||'', t.source||'NeST'
  ]);
  const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = `TenderEdge_Export_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  showToast('âœ… CSV exported successfully!');
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}

// â”€â”€ KEYBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModal();
});
</script>
</body>
</html>
